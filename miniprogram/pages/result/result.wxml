<!-- pages/result/result.wxml -->
<view class="page-wrapper">
  <!-- 背景图片 -->
  <image class="bg-image" src="/images/logo.jpg" mode="aspectFill"></image>

  <!-- 内容层 -->
  <view class="content-layer">
    <!-- 匹配成功 -->
    <view wx:if="{{status === 'matched'}}" class="result-card">
      <text class="title" wx:if="{{!isAlreadyMatched}}">🎉 有一位潜在室友，快联系TA吧</text>
      <text class="title" wx:if="{{isAlreadyMatched}}">✅ 你已匹配过这位室友</text>

      <!-- 倒计时提示 -->
      <view wx:if="{{!isAlreadyMatched}}" class="countdown-tip">
        ⏰ 请在 {{countdown}} 秒内选择，否则匹配将自动取消
      </view>

      <!-- 日期不完全匹配提示 -->
      <view wx:if="{{dateMatchType === 'partial'}}" class="date-warning">
        <text class="warning-icon">⚠️</text>
        <text class="warning-text">注意：你们的入住日期不完全相同，仅有部分重叠。建议联系对方确认具体日期。</text>
      </view>

      <view class="info-item">
        <text class="label">对方姓名</text>
        <text class="value">{{match.name}}</text>
      </view>

      <view class="info-item">
        <text class="label">微信号</text>
        <text class="value">{{match.wechat_id}}</text>
      </view>

      <view class="info-item">
        <text class="label">入住日期</text>
        <text class="value">{{match.check_in}} 至 {{match.check_out}}</text>
      </view>

      <view class="info-item">
        <text class="label">吸烟习惯</text>
        <text class="value">{{match.smoking === 'yes' ? '吸烟' : '不吸烟'}}</text>
      </view>

      <view class="info-item">
        <text class="label">作息倾向</text>
        <text class="value">{{match.schedule === 'early_bird' ? '早睡鸟' : '夜猫子'}}</text>
      </view>

      <view class="info-item">
        <text class="label">噪音容忍度</text>
        <text class="value">{{match.noise_in === 'weak' ? '敏感' : (match.noise_in === 'medium' ? '普通' : '不敏感')}}</text>
      </view>

      <view class="info-item">
        <text class="label">睡眠声响</text>
        <text class="value">{{match.noise_out === 'silent' ? '安静' : (match.noise_out === 'loud' ? '偶有声响' : '声响较大')}}</text>
      </view>

      <view class="button-group">
        <button class="secondary-btn" bindtap="onCopyWechat">{{isAlreadyMatched ? '去加微信' : '复制微信号'}}</button>
        <button class="danger-btn" bindtap="onRematch">重新匹配</button>
      </view>
    </view>

    <!-- 等待匹配 -->
    <view wx:if="{{status === 'waiting'}}" class="result-card">
      <text class="title">⏳ 等待匹配中</text>
      <text class="message">已加入匹配池，等待其他用户加入</text>
      <text class="tip">匹配成功后我们会通知您</text>
      <button class="main-btn" bindtap="onBackHome">返回首页</button>
    </view>

    <!-- 部分匹配 -->
    <view wx:if="{{status === 'partial'}}" class="result-card">
      <text class="title">💡 发现潜在室友</text>
      <text class="message">有 {{partialMatches.length}} 位用户与您习惯匹配，但入住日期需调整</text>

      <view class="partial-list">
        <view class="partial-item" wx:for="{{partialMatches}}" wx:key="wechat_id">
          <view class="partial-header">
            <text class="partial-name">{{item.name}}</text>
            <text class="partial-wechat">{{item.wechat_id}}</text>
          </view>
          <view class="partial-dates">
            <text class="date-label">对方日期：</text>
            <text class="date-value">{{item.check_in}} 至 {{item.check_out}}</text>
          </view>
          <view class="partial-overlap">
            <text class="overlap-label">可重叠：</text>
            <text class="overlap-value">{{item.overlap_start}} 至 {{item.overlap_end}}</text>
          </view>
        </view>
      </view>

      <text class="tip">建议调整入住日期后重新提交</text>
      <button class="main-btn" bindtap="onBackHome">返回首页</button>
    </view>

    <!-- 加载中 -->
    <view wx:if="{{!status}}" class="result-card">
      <text class="message">加载中...</text>
    </view>

    <!-- 许愿入口 -->
    <view class="wish-link" bindtap="goToWish">
      💭 许个愿
    </view>
  </view>
</view>
